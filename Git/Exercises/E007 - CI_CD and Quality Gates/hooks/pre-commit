#!/usr/bin/env bash
# Pre-commit hook with comments for Big Dawgie ğŸ¾
# - Blocks commits if any staged file contains "TODO"
# - Runs flake8 if available, fails commit on lint errors
# This runs automatically before 'git commit' completes.

set -euo pipefail

echo "ğŸ” Running pre-commit checks..."

# 1) Abort if any staged file contains 'TODO' (case-insensitive)
# 'git diff --cached' shows staged changes (what will be committed)
if git diff --cached | grep -qi "TODO"; then
  echo "âŒ Commit blocked: staged changes contain 'TODO'"
  echo "   â†’ Remove or address TODOs before committing."
  exit 1
fi

# 2) If flake8 is installed, run it to catch Python style issues.
if command -v flake8 >/dev/null 2>&1; then
  echo "ğŸ Running flake8..."
  if ! flake8 .; then
    echo "âŒ Commit blocked: flake8 reported style issues."
    echo "   â†’ Fix lint errors, add changes, and try committing again."
    exit 1
  fi
else
  echo "â„¹ï¸ flake8 not found; skipping Python lint step."
fi

echo "âœ… Pre-commit checks passed."
exit 0