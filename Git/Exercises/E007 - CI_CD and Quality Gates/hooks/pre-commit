#!/usr/bin/env bash
# Pre-commit hook with comments for Big Dawgie 🐾
# - Blocks commits if any staged file contains "TODO"
# - Runs flake8 if available, fails commit on lint errors
# This runs automatically before 'git commit' completes.

set -euo pipefail

echo "🔎 Running pre-commit checks..."

# 1) Abort if any staged file contains 'TODO' (case-insensitive)
# 'git diff --cached' shows staged changes (what will be committed)
if git diff --cached | grep -qi "TODO"; then
  echo "❌ Commit blocked: staged changes contain 'TODO'"
  echo "   → Remove or address TODOs before committing."
  exit 1
fi

# 2) If flake8 is installed, run it to catch Python style issues.
if command -v flake8 >/dev/null 2>&1; then
  echo "🐍 Running flake8..."
  if ! flake8 .; then
    echo "❌ Commit blocked: flake8 reported style issues."
    echo "   → Fix lint errors, add changes, and try committing again."
    exit 1
  fi
else
  echo "ℹ️ flake8 not found; skipping Python lint step."
fi

echo "✅ Pre-commit checks passed."
exit 0